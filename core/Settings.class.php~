<?php
class Settings {
	
	private $path;
	private $data = Array();
	private $marked = false;
	
	public function __construct($extension, $name="settings"){
		$this->path = Framework::getConfigPath($extension) . "$name.json";
		
		if(file_exists($this->path))
			$this->data = unserialize(file_get_contents($this->path));
		
		if(!is_array($this->data))
			$this->data = Array();
	}
	
	public function getValue($key, $def=null){
		return array_key_exists($key, $this->data) ? $this->data[$key] : $def;
	}
	
	public function setValue($key, $val){
		$this->data[$key] = $val;
		$this->save();
		return;
		if(!$this->marked){
			$this->marked = true;
			register_shutdown_function(Array($this, "save"));
		}
	}
	
	public function getStoragePath(){
		return $this->path;
	}
	
	public function save(){
		file_put_contents($this->path, serialize($this->data));
	}
	
}
?>
